# 用UDP就一定比用TCP快吗

很多人提到 UDP 时，第一反应是“它不需要建立连接，所以比 TCP 快”。这句话只说对了一半。UDP 的确避免了握手和确认的开销，但真正的性能
表现取决于业务模式、网络状况以及应用层实现。本节从多个角度解析这个常见误区。

## UDP 的“快”来自哪里

- **无连接、无需握手**：发送第一个数据报前不必等待三次握手，适合短暂交互或实时性极高的场景，如 DNS 查询、VoIP、游戏状态同步。
- **不做可靠性保证**：内核不会重传、排序或拥塞控制，所有包一律尽快发出去，因此在理想网络中延迟更低。
- **报文边界天然存在**：每个 `sendto` 对应一个数据报，接收端无需拆包粘包处理，减少应用层操作。

## UDP 不一定更快的原因

1. **应用层补课**：如果业务无法容忍丢包，就必须自己实现重传、确认、排序、拥塞控制。这些逻辑不一定比 TCP 内核实现更高效，反而会占用 CPU。
2. **网络环境复杂**：在丢包率较高的公网或无线网络中，UDP 包丢失后需要应用层重发，整体延迟可能比 TCP 还高。TCP 的快速重传、拥塞控制在这
   些情况下反而更稳。
3. **内核优化与硬件加速**：现代网络栈对 TCP 做了大量优化，例如 TSO/GSO、RTO 算法、BPF 加速等；而 UDP 未必能享受全部优化，甚至可能被限速
   （如运营商对 UDP 流量的限制）。
4. **中间设备的偏好**：许多防火墙、NAT 对 TCP 支持更好，UDP 数据报可能被丢弃或超时关闭映射，需要额外的保活流量。
5. **数据尺寸与粘包**：对于大量连续传输的场景，TCP 的流式特性更适合。UDP 要求每个数据报都在 MTU 以内，否则需要应用自行切分，大量小
   报文反而增加报头开销。

## 选择协议时的思考维度

- **可靠性 vs. 时延**：如果业务允许偶尔丢包但要“最快到达”，UDP 合适；若要保证每个字节都到达并有序，则应优先考虑 TCP。
- **传输持续时间**：短连接的开销在 TCP 中较大（握手 + 关闭），UDP 优势明显；长连接场景中，握手成本可以忽略，TCP 的拥塞控制和流量调度更
  有帮助。
- **数据格式**：实时音视频、游戏状态同步天然以帧/事件为单位，适合 UDP；文件传输、数据库同步等需要完整性，使用 TCP 更稳。
- **网络环境**：内网高带宽、低延迟情况下 UDP 的优势容易体现；公网或跨国链路中，TCP 的自适应机制往往更可靠。

## 案例对比

- **DNS 查询**：每次请求只有几十字节，UDP 的单报文发送非常高效；只有在响应超过 512 字节或需要安全特性时才会切换到 TCP。
- **实时语音通话**：UDP 避免了重传导致的延迟累积，丢包通过前向纠错或插值弥补。
- **Web 页面加载**：现代 HTTP/2、HTTP/3（基于 QUIC）借鉴了 TCP 的可靠性，配合多路复用和拥塞控制。注意 HTTP/3 虽运行在 UDP 之上，但它在
  应用层实现了完整的可靠性和拥塞控制，所以“UDP 的速度优势”被协议栈重新平衡。

## 小结

UDP 的“快”是建立在“少做事”之上的，真正的吞吐和延迟表现还要看应用如何使用它。不要仅因为“UDP 更快”就盲目选择协议，而应结合业务需求、
网络环境以及实现成本做出决策。对于绝大多数可靠传输需求，成熟的 TCP 仍然是首选；在需要低延迟或可容忍丢包的场景中，再发挥 UDP 的灵活
性。

---

*本文档为《网络101》系列的一部分*
