# Wireshark 抓包入门实战指南

Wireshark 是排查网络问题最常用的工具之一，它能把经过网卡的每个数据包都记录下来，并以协议解析的方式展示。下面我们以“观察浏览器访问网站”为例，带你从零开始完成一次完整的抓包分析。

## 1. 准备工作
- **安装软件**：Windows、macOS 可以直接下载 Wireshark 安装包；Linux 推荐通过发行版包管理器安装，同时确保 `dumpcap` 有足够的权限。
- **选择合适的网卡**：笔记本通常同时拥有有线、无线接口，开始抓包前要确认数据流量会走哪一个接口，可以通过 `ipconfig`/`ifconfig` 查看当前的默认网关。
- **清理现场**：关闭后台大量占用网络的程序（云盘同步、视频会议等），避免抓到过多无关流量。

## 2. 开始捕获
1. 启动 Wireshark 后，在主界面找到目标网络接口并双击。
2. 若只关心特定协议，可在左上角的 “Capture Filter” 填写表达式，例如 `tcp port 443`。
3. 点击开始后，Wireshark 会实时显示捕获的包列表，每一行都是一个数据包。

> 捕获过滤器和显示过滤器不同。捕获过滤器在开始前设置，减少写入的包；显示过滤器用于对已经捕获的数据做筛选。

## 3. 制造一个可观察的请求
在浏览器中访问 https://example.com，等待页面加载完成。此时 Wireshark 会捕捉到大量 TCP/UDP 包。为了后续分析方便，可以点击工具栏的“停止”按钮暂停抓包，再执行下一步。

## 4. 使用显示过滤器聚焦关键信息
- 在过滤器输入框中输入 `http` 或 `tls.handshake`，只查看 HTTP 或 TLS 握手相关的数据包。
- 如果知道服务器 IP，可以使用 `ip.addr == 93.184.216.34` 进行过滤；或者 `tcp.stream eq 4` 聚焦到某条 TCP 连接。
- 通过颜色规则快速识别异常：深红色常常代表 TCP 重传或错误，黑色表示校验失败。

## 5. 深入解析一个 TCP 会话
1. 在包列表中选中任意一个 HTTP 请求；
2. 右键选择“Follow → TCP Stream”，Wireshark 会把该连接的所有数据按时间顺序展示出来，并自动过滤出当前会话；
3. 在新窗口里既能看到请求报文，也能看到响应，支持以 ASCII、十六进制、原始字节等形式查看；
4. 如果是 HTTPS，可以观察 TLS 握手的 ClientHello、ServerHello 信息，了解协商的加密套件与证书情况。

## 6. 常见排障技巧
- **确认是否发出请求**：过滤 `tcp.flags.syn == 1`，查看是否真的发送了 SYN 包；
- **检测丢包与重传**：应用显示过滤器 `tcp.analysis.retransmission` 或 `tcp.analysis.fast_retransmission`；
- **判断是否超时**：观察 TCP 流中是否存在长时间的间隔、重复的 SYN、或 RTO（Retransmission Timeout）重传；
- **导出数据**：在“File → Export Specified Packets”中选择需要的包，方便与同事共享分析结果。

## 7. 抓包安全与合规
抓包往往涉及敏感信息：
- 尽量在测试环境或得到授权的情况下操作；
- 对包含口令、会话凭证的数据包要妥善保管；
- 如果需要在生产环境抓包，务必与安全、运维团队协作，遵守公司制度。

通过上述步骤，你已经掌握了使用 Wireshark 抓包的基本流程。之后配合本书后续章节的案例练习，就能逐渐把抓包技巧融入日常排障和性能分析的工作中。
