# 两台计算机如何真正“看见”彼此

很多初学者以为“用网线把两台计算机连起来”就能互相通信，但在网络的语境里，硬件连线只是第一步。想让两台机器顺利交换数据，需要同时满足地址规划、链路层解析、网络层路由、传输层端口等多重条件。

## 第一步：确定物理连通性
- **链路类型**：现代网卡支持 Auto MDI-X，可自动调整直连交叉线，无需额外集线器；如果是老旧设备或需要长距离传输，可能要通过交换机或光纤模块。
- **双工与速率**：两端协商速率和全/半双工模式，如果协商失败就可能产生大量冲突或丢包，ping 都不通。
- **驱动状态**：操作系统必须识别到网卡，并显示链路状态为 UP。否则上层协议没有意义。

## 第二步：配置网络层参数
- **IP 地址和子网掩码**：两台计算机需要处于同一网段，例如 192.168.10.1/24 与 192.168.10.2/24。掩码不同可能导致一端认为对方不在本地网段，从而把流量发给默认网关，导致 ARP 失败。
- **默认网关**：如果只是直连并且不需要访问外部网络，可以不配置网关；但在企业网络中，即使两台主机同网段，也推荐配置网关以便访问其他子网。
- **DNS**：对主机名通信不是必需，但用于调试时最好保留，方便通过域名解析检验网络栈。

## 第三步：链路层解析（ARP）
当 A 主机要给 B 主机发包时，它会：
1. 检查自身的路由表确认目的 IP 在本地子网；
2. 在 ARP 缓存中寻找目的 IP 对应的 MAC 地址；
3. 如果没有，就广播 ARP 请求：“谁是 192.168.10.2？”
4. B 主机回应自己的 MAC 地址，A 将其缓存后才可以封装以太网帧。

若 ARP 被防火墙拦截、静态绑定错误或缓存条目过期，就会出现“ping 不通”的假象。

## 第四步：传输层握手
地址解析成功后，数据包才有机会抵达对方的传输层。常见的 TCP 建立连接流程包括：

- A 发送 SYN（包含初始序列号）到 B；
- B 回复 SYN+ACK 并选择自己的初始序列号；
- A 再发 ACK 确认，连接正式建立。

如果中间任何一步丢失，TCP 会重传并在超时后返回错误。UDP 则没有握手，应用需要自行处理丢包与顺序。

## 常见排障思路
- `ping` 测试 ICMP 往返时延，验证 IP 层可达性；
- `arp -a` 查看是否正确解析了对方 MAC；
- `tracert`/`traceroute` 观察数据包经过的网关，确认是否被误路由；
- `tcpdump` 或 Wireshark 抓包，分析握手是否顺利、是否有 RST/ICMP 错误返回。

通过以上步骤，你会发现“让两台计算机互连”其实是一个层层递进的过程。只有每一层都配置正确，通信才能顺利进行。
