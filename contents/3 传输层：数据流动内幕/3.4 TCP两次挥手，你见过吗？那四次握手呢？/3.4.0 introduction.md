# 引言

TCP 的握手与挥手流程在教科书中似乎固定不变，但在真实网络里，两个、三个甚至四次挥手都可能出现。本节将以状态机为主线，梳理 FIN/ACK 的时序变体，解释它们背后隐藏的应用行为与内核策略，帮助你在抓包中遇到异常序列时不再困惑。

我们会分别分析客户端、服务端在不同关闭模式（主动关闭、被动关闭、半关闭）下的行为，讨论 TIME_WAIT、CLOSE_WAIT、LAST_ACK 等状态的含义与风险。通过案例展示应用层缓冲区未清空、延迟关闭、双向 FIN 交错等情形，指出如何调整 SO_LINGER、优雅关闭逻辑以及内核参数来避免资源耗尽。

掌握这些知识后，你能从一条抓包记录中迅速识别异常挥手，判断是否存在资源泄漏或协议栈 Bug，并为高并发服务设计更可靠的连接管理策略。
